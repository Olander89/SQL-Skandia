

CREATE TABLE #temptable (
	  [KontoID] VARCHAR(25) NULL,
	  [Typ av lån] VARCHAR(50) NULL,
	  [Kredittyp] VARCHAR(50) NULL,
	  [Kontonummer] VARCHAR(25) NULL,
	  [Personnummer] VARCHAR(12) NULL,
	  [Skuld] FLOAT NULL,
	  [Ränta] FLOAT NULL,
	  [Skuld+Ränta] FLOAT NULL,
	  [Kundens totala exponering] FLOAT NULL,
	  [Del av kundens totala exponering] FLOAT NULL,
	  [Smittad exponering] FLOAT NULL,
	  [Antal dagar övertrasserad] INT NULL,
	  [Steg] VARCHAR(50) NULL,							
	  [Reservering_Skuld] FLOAT NULL,
	  [Reservering_Ränta] FLOAT NULL,							
	  [Eftergift] VARCHAR(10) NULL,
	  [Beviljad kredit] FLOAT NULL,
	  [BeviljatDatum] DATETIME NULL,
	  [Ej utnyttjad kredit] FLOAT NULL,
	  [Reservering för ej utnyttjad kredit] FLOAT NULL,
	  [Total reservering] FLOAT NULL,
	  [Ny kredit] FLOAT NULL);

SET ARITHABORT OFF
SET ANSI_WARNINGS ON
SET ANSI_NULLS OFF
INSERT INTO #temptable
EXEC [ssrs].[usp_Ekonomi_IFRS9_Osäkra_Krediter_Blancoanalys]
	 @Period = '202008',
	 @UCRP_Kontokredit = 0.0185,
	 @UCRP_Kreditkort = 0.0232,
	 @UCRP_Privatlan = 0.029,
	 @UCRP_Övrigt = 0.0232,
	 @CCF_Kontokredit = 0.25,
	 @CCF_Kreditkort = 0.17,
	 @CCF_Privatlan = 0.84,
	 @CCF_Övrigt = 0.18,
	 @LGD = 0.23

ALTER TABLE #temptable
ADD Period VARCHAR(6) NULL

UPDATE #temptable
SET Period = '202008'

INSERT INTO kredit.[dbo].[Blancoanalys_test]
SELECT * FROM #temptable 

DROP TABLE #temptable





CREATE TABLE kredit.dbo.Blancoanalys_backup (
	  [KontoID] VARCHAR(25) NULL,
	  [Typ av lån] VARCHAR(50) NULL,
	  [Kredittyp] VARCHAR(50) NULL,
	  [Kontonummer] VARCHAR(25) NULL,
	  [Skuld] FLOAT NULL,
	  [Ränta] FLOAT NULL,
	  [Skuld+Ränta] FLOAT NULL,
	  [Steg] VARCHAR(50) NULL,	
	  [Beviljad kredit] FLOAT NULL,
	  [Ej utnyttjad kredit] FLOAT NULL,
	  [Ny kredit] FLOAT NULL,
	  [Personnummer] VARCHAR(12) NULL,
	  [BeviljatDatum] DATETIME NULL,
	  [Period] VARCHAR(6) NULL);

INSERT INTO kredit.dbo.Blancoanalys_backup
SELECT DISTINCT
ba.[KontoID],
ba.[Typ av lån],
ba.[Kredittyp],
ba.[Kontonummer],
ba.[Skuld],
ba.[Ränta],
ba.[Skuld+Ränta],
ba.[Steg],
ba.[Beviljad kredit],
ba.[Ej utnyttjad kredit],
ba.[Ny kredit],
ba.[Personnummer],
ba.BeviljatDatum,
ba.[Period]
FROM kredit.[dbo].[Blancoanalys_test] ba

DROP TABLE kredit.[dbo].[Blancoanalys_test]




USE Kredit;   
GO  
EXEC sp_rename 'kredit.dbo.Blancoanalys_test2', 'Blancoanalys_test';
